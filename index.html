<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>StoreBox by martino2k6</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">StoreBox</h1>
      <h2 class="project-tagline">Android library for streamlining SharedPreferences</h2>
      <a href="https://github.com/martino2k6/StoreBox" class="btn">View on GitHub</a>
      <a href="https://github.com/martino2k6/StoreBox/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/martino2k6/StoreBox/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>StoreBox is an annotation-based library for interacting with Android's SharedPreferences, with the aim take out the the <em>how</em> and <em>where</em> parts of retrieving/storing values and instead focus on the more important <em>what</em> part.</p>

<p>Normally when retrieving or storing values we need to know two pieces of information during each call: the key and the type.</p>

<div class="highlight highlight-Java"><pre><span class="pl-smi">String</span> username <span class="pl-k">=</span> preferences<span class="pl-k">.</span>getString(<span class="pl-s"><span class="pl-pds">"</span>key_username<span class="pl-pds">"</span></span>, <span class="pl-c1">null</span>);
preferences<span class="pl-k">.</span>edit()<span class="pl-k">.</span>putString(<span class="pl-s"><span class="pl-pds">"</span>key_date_of_birth<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>30/09/2004<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>apply(); <span class="pl-c">// should this be a String or a long?</span></pre></div>

<p>With StoreBox the operations above can be changed into pre-defined methods with improved semantics.</p>

<div class="highlight highlight-Java"><pre><span class="pl-c">// definition</span>
<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">MyPreferences</span> {

    <span class="pl-k">@KeyByString</span>(<span class="pl-s"><span class="pl-pds">"</span>key_username<span class="pl-pds">"</span></span>)
    <span class="pl-smi">String</span> <span class="pl-en">getUsername</span>();

    <span class="pl-k">@KeyByString</span>(<span class="pl-s"><span class="pl-pds">"</span>key_date_of_birth<span class="pl-pds">"</span></span>)
    <span class="pl-k">void</span> <span class="pl-en">setDateOfBirth</span>(<span class="pl-smi">String</span> <span class="pl-v">value</span>);
}

<span class="pl-c">// usage</span>
<span class="pl-smi">MyPreferences</span> preferences <span class="pl-k">=</span> <span class="pl-smi">StoreBox</span><span class="pl-k">.</span>create(context, <span class="pl-smi">MyPreferences</span><span class="pl-k">.</span>class);
<span class="pl-smi">String</span> username <span class="pl-k">=</span> preferences<span class="pl-k">.</span>getUsername();
preferences<span class="pl-k">.</span>setDateOfBirth(<span class="pl-s"><span class="pl-pds">"</span>30/09/2004<span class="pl-pds">"</span></span>);</pre></div>

<p>The caller now doesn't need to worry about the key, neither about what type the values are stored under. The only important part that needs to be taken into consideration is <em>what</em> is done with the values, whether that is storing them for later, showing them to the user in the UI, or just changing application behaviour.</p>

<p>Read on to find out more details about how StoreBox can be used and how it can be added to an Android project.</p>

<h2>
<a id="defining-an-interface-and-bringing-it-to-life" class="anchor" href="#defining-an-interface-and-bringing-it-to-life" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining an interface and bringing it to life</h2>

<p>Simply create a new interface class in your IDE or a text editor, give it an access modifier which suits its use, and name it as appropriate.</p>

<div class="highlight highlight-Java"><pre><span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">MyPreferences</span> {

}</pre></div>

<p>Now you're ready to use <code>StoreBox.create()</code> to obtain an instance.</p>

<div class="highlight highlight-Java"><pre><span class="pl-smi">MyPreferences</span> instance <span class="pl-k">=</span> <span class="pl-smi">StoreBox</span><span class="pl-k">.</span>create(context, <span class="pl-smi">MyPreferences</span><span class="pl-k">.</span>class);</pre></div>

<h2>
<a id="adding-get-and-set-methods" class="anchor" href="#adding-get-and-set-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding get and set methods</h2>

<p>If you would like to add a <strong>getter</strong> just add a method to the interface which returns a value and make sure to annotate it using <code>@KeyByString</code> or <code>@KeyByResource</code>. Please note that for now only values which the <code>SharedPreferences</code> accept can be used (except <code>Set&lt;String&gt;</code> for the moment).</p>

<div class="highlight highlight-Java"><pre>@KeyByString(<span class="pl-s"><span class="pl-pds">"</span>key_nickname<span class="pl-pds">"</span></span>)
<span class="pl-smi">String</span> getNickname();

@KeyByResource(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>key_notifications)
<span class="pl-k">boolean</span> shouldShowNotifications();</pre></div>

<p>If you try to define a method that returns something like a <code>Date</code> object, which cannot be saved by Android, an exception will be thrown.</p>

<div class="highlight highlight-Java"><pre>@KeyByString(<span class="pl-s"><span class="pl-pds">"</span>key_date_of_birth<span class="pl-pds">"</span></span>)
<span class="pl-smi">Date</span> getDateOfBirth(); <span class="pl-c">// invalid</span></pre></div>

<p>Adding a <strong>setter</strong> is just as easy. The same annotations will need to be used as for getter methods, but now our method will return nothing and will have to provide a parameter for supplying the value that should be saved.</p>

<div class="highlight highlight-Java"><pre>@KeyByString(<span class="pl-s"><span class="pl-pds">"</span>key_nickname<span class="pl-pds">"</span></span>)
<span class="pl-k">void</span> setNickname(<span class="pl-smi">String</span> value)

@KeyByResource(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>key_notifications)
<span class="pl-k">void</span> setNotifications(<span class="pl-k">boolean</span> value)</pre></div>

<p>Just like with get methods only the common types are supported, and as such the example below will not work.</p>

<div class="highlight highlight-Java"><pre>@KeyByString(<span class="pl-s"><span class="pl-pds">"</span>key_date_of_birth<span class="pl-pds">"</span></span>)
<span class="pl-k">void</span> setDateOfBirth(<span class="pl-smi">Date</span> value); <span class="pl-c">// invalid</span></pre></div>

<h2>
<a id="specifying-defaults-for-get-methods" class="anchor" href="#specifying-defaults-for-get-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Specifying defaults for get methods</h2>

<p>This can be achieved in two ways, through an argument or by using an annotation.</p>

<p>For the first option the following will work.</p>

<div class="highlight highlight-Java"><pre>@KeyByString(<span class="pl-s"><span class="pl-pds">"</span>key_phone_number<span class="pl-pds">"</span></span>)
<span class="pl-smi">String</span> getPhoneNumber(<span class="pl-smi">String</span> defValue);</pre></div>

<p>And using an annotation referencing a default found in the XML resources.</p>

<div class="highlight highlight-Java"><pre>@KeyByString(<span class="pl-s"><span class="pl-pds">"</span>key_phone_number<span class="pl-pds">"</span></span>)
@DefaultValue(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>default_phone_number)
<span class="pl-smi">String</span> getPhoneNumber();</pre></div>

<p>For some types, such as <code>long</code>, which cannot be added to the resources an integer resource may be used instead.</p>

<div class="highlight highlight-Java"><pre>@KeyByString(<span class="pl-s"><span class="pl-pds">"</span>key_refresh_interval<span class="pl-pds">"</span></span>)
@DefaultValue(<span class="pl-smi">R</span><span class="pl-k">.</span>integer<span class="pl-k">.</span>default_refresh_interval)
<span class="pl-k">long</span> getRefreshInterval();</pre></div>

<h2>
<a id="opening-different-types-of-preferences" class="anchor" href="#opening-different-types-of-preferences" aria-hidden="true"><span class="octicon octicon-link"></span></a>Opening different types of preferences</h2>

<p>In all of the examples so far details about what preferences are opened and how have been omitted.</p>

<p>Without any annotation the default shared preferences will be used, but the <code>@DefaultSharedPreferences</code> annotation can be added to the interface definition for explicitness. Likewise, <code>@ActivityPreferences</code> or <code>@FilePreferences</code> can be used to respectively open preferences private to an activity or to open preferences using a file name.</p>

<p>The mode with which the preferences should be opened can also be specified, although this option is not supported by all the types.</p>

<div class="highlight highlight-Java"><pre>@ActivityPreferences(mode <span class="pl-k">=</span> <span class="pl-smi">PreferencesMode</span><span class="pl-c1"><span class="pl-k">.</span>MULTI_PROCESS</span>)
<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">WelcomeActivityPreferences</span> {

    <span class="pl-c">// method definitions here...</span>
}</pre></div>

<h2>
<a id="adding-to-a-project" class="anchor" href="#adding-to-a-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding to a project</h2>

<p>StoreBox can be used in Android projects using minimum SDK version 10 and newer (Android 2.3+).</p>

<h3>
<a id="jar" class="anchor" href="#jar" aria-hidden="true"><span class="octicon octicon-link"></span></a>JAR</h3>

<p><a href="https://oss.sonatype.org/service/local/repositories/releases/content/net/orange-box/storebox/storebox-lib/1.1.0/storebox-lib-1.1.0.jar">v1.1.0 JAR</a><br>
<a href="https://oss.sonatype.org/service/local/repositories/releases/content/net/orange-box/storebox/storebox-lib/1.1.0/storebox-lib-1.1.0-javadoc.jar">v1.1.0 JavaDoc JAR</a></p>

<h3>
<a id="gradle" class="anchor" href="#gradle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gradle</h3>

<pre><code>compile 'net.orange-box.storebox:storebox-lib:1.1.0'
</code></pre>

<h3>
<a id="maven" class="anchor" href="#maven" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maven</h3>

<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;net.orange-box.storebox&lt;/groupId&gt;
  &lt;artifactId&gt;storebox-lib&lt;/artifactId&gt;
  &lt;version&gt;1.1.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h2>
<a id="advanced" class="anchor" href="#advanced" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced</h2>

<h3>
<a id="remove-methods" class="anchor" href="#remove-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remove methods</h3>

<p>In order to remove a value stored in the preferences under a key a method to perform the removal can be annotated with the <code>@RemoveMethod</code> annotation. The key can be supplied in two ways;</p>

<p>The key can be provided thorough an argument in the method, using either a <code>String</code> or an <code>int</code> in the case of the key being specified in an XML resource.</p>

<div class="highlight highlight-Java"><pre><span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">RemoveMethodExample</span> {

    <span class="pl-k">@RemoveMethod</span>
    <span class="pl-k">void</span> <span class="pl-en">remove</span>(<span class="pl-smi">String</span> <span class="pl-v">key</span>);

    <span class="pl-k">@RemoveMethod</span>
    <span class="pl-k">void</span> <span class="pl-en">remove</span>(<span class="pl-k">int</span> <span class="pl-v">keyRes</span>);
}

<span class="pl-c">// usage</span>
preferences<span class="pl-k">.</span>remove(<span class="pl-s"><span class="pl-pds">"</span>key_username<span class="pl-pds">"</span></span>);
preferences<span class="pl-k">.</span>remove(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>key_password);</pre></div>

<p>Or a value-specific remove method can be defined with the help of the <code>@KeyByString</code> or <code>@KeyByResource</code> annotations.</p>

<div class="highlight highlight-Java"><pre><span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">RemoveMethodExample</span> {

    <span class="pl-k">@KeyByString</span>(<span class="pl-s"><span class="pl-pds">"</span>key_username<span class="pl-pds">"</span></span>)
    <span class="pl-k">@RemoveMethod</span>
    <span class="pl-k">void</span> <span class="pl-en">removeUsername</span>();

    <span class="pl-k">@KeyByResource</span>(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>key_password)
    <span class="pl-k">@RemoveMethod</span>
    <span class="pl-k">void</span> <span class="pl-en">removePassword</span>()
}

<span class="pl-c">// usage</span>
preferences.<span class="pl-en">removeUsername</span>();
preferences.<span class="pl-en">removePassword</span>();</pre></div>

<h3>
<a id="chaining-calls" class="anchor" href="#chaining-calls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chaining calls</h3>

<p>With Android's <code>SharedPreferences.Editor</code> class it is possible to keep chaining put methods as each returns back the <code>SharedPreferences.Editor</code> instance. StoreBox allows the same functionality. All that needs to be done is to change the set/remove method definitions to either return interface type itself or <code>SharedPreferences.Editor</code>.</p>

<div class="highlight highlight-Java"><pre><span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">ChainingExample</span> {

    <span class="pl-k">@KeyByString</span>(<span class="pl-s"><span class="pl-pds">"</span>key_username<span class="pl-pds">"</span></span>)
    <span class="pl-smi">ChainingExample</span> <span class="pl-en">setUsername</span>(<span class="pl-smi">String</span> <span class="pl-v">value</span>);

    <span class="pl-k">@KeyByString</span>(<span class="pl-s"><span class="pl-pds">"</span>key_password<span class="pl-pds">"</span></span>)
    <span class="pl-smi">ChainingExample</span> <span class="pl-en">setPassword</span>(<span class="pl-smi">String</span> <span class="pl-v">value</span>);

    <span class="pl-k">@KeyByString</span>(<span class="pl-s"><span class="pl-pds">"</span>key_country<span class="pl-pds">"</span></span>)
    <span class="pl-smi">ChainingExample</span> <span class="pl-en">removeCountry</span>();
}</pre></div>

<p>And calls can be chained as</p>

<div class="highlight highlight-Java"><pre>preferences<span class="pl-k">.</span>setUsername(<span class="pl-s"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>setPassword(<span class="pl-s"><span class="pl-pds">"</span>jOe<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>removeCountry();</pre></div>

<h3>
<a id="forwarding-calls" class="anchor" href="#forwarding-calls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Forwarding calls</h3>

<p>If you would like to access methods from the <code>SharedPreferences</code> or <code>SharedPreferences.Editor</code>, you can do that by extending your interface from either of the above (or even both).</p>

<div class="highlight highlight-Java"><pre><span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">ForwardingExample</span> <span class="pl-k">extends</span> <span class="pl-e">SharedPreferences</span>, <span class="pl-e">SharedPreferences</span>.<span class="pl-e">Editor</span> {

    <span class="pl-c">// method definitions here</span>
}</pre></div>

<p>And the methods from either of the extended interfaces will be callable.</p>

<div class="highlight highlight-Java"><pre><span class="pl-smi">String</span> username <span class="pl-k">=</span> preferences<span class="pl-k">.</span>getString(<span class="pl-s"><span class="pl-pds">"</span>key_username<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
preferences<span class="pl-k">.</span>putString(<span class="pl-s"><span class="pl-pds">"</span>key_username<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>apply();</pre></div>

<h3>
<a id="save-modes" class="anchor" href="#save-modes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Save modes</h3>

<p>Changes to preferences can normally be saved on Android either through <code>apply()</code> or <code>commit()</code>. Which method gets used can be customised in StoreBox through the use of the <code>@SaveOption</code> annotation.</p>

<p>Unlike any of the previous annotations <code>@SaveOption</code> can be used to annotate both the interface as well as individual set/remove methods, however an annotation at method-level will take precedence over an interface annotation.</p>

<div class="highlight highlight-Java"><pre>@SaveOption(<span class="pl-smi">SaveMode</span><span class="pl-c1"><span class="pl-k">.</span>APPLY</span>)
<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">SaveModeExample</span> {
    <span class="pl-c">// key annotations omitted</span>

    <span class="pl-k">void</span> <span class="pl-en">setUsername</span>(<span class="pl-smi">String</span> <span class="pl-v">value</span>); <span class="pl-c">// will save using apply()</span>

    <span class="pl-k">@SaveOption</span>(<span class="pl-smi">SaveMode</span><span class="pl-c1"><span class="pl-k">.</span>COMMIT</span>)
    <span class="pl-k">void</span> <span class="pl-en">setPassword</span>(<span class="pl-smi">String</span> <span class="pl-v">value</span>); <span class="pl-c">// will save using commit()</span>

    <span class="pl-k">@SaveOption</span>(<span class="pl-smi">SaveMode</span><span class="pl-c1"><span class="pl-k">.</span>COMMIT</span>)
    <span class="pl-k">void</span> <span class="pl-en">removeUsername</span>(); <span class="pl-c">// will persist using commit()</span>
}</pre></div>

<h3>
<a id="default-value-modes" class="anchor" href="#default-value-modes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Default value modes</h3>

<p>Supplying default values, either by using an argument or an annotation, has been covered earlier but there's further customisation possible.</p>

<p>The <code>@DefaultValueOption</code> works in a similar way to the <code>@SaveOption</code> annotation in how it can be used, but it specifies what default value should be returned in the absence of a more explicit value.</p>

<div class="highlight highlight-Java"><pre>@DefaulltValueOption(<span class="pl-smi">DefaultValueMode</span><span class="pl-c1"><span class="pl-k">.</span>EMPTY</span>)
<span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">DefaultValueModeExample</span> {
    <span class="pl-c">// key annotations omitted</span>

    <span class="pl-smi">String</span> <span class="pl-en">getUsername</span>(); <span class="pl-c">// will return ""</span>

    <span class="pl-k">@DefaultValueOption</span>(<span class="pl-smi">DefaultValueMode</span><span class="pl-c1"><span class="pl-k">.</span>NULL</span>)
    <span class="pl-smi">String</span> <span class="pl-en">getPassword</span>(); <span class="pl-c">// will return null</span>

    <span class="pl-k">int</span> <span class="pl-en">getAppOpenedCount</span>(); <span class="pl-c">// will return 0</span>

    <span class="pl-k">@DefaultValueOption</span>(<span class="pl-smi">DefaultValueMode</span><span class="pl-c1"><span class="pl-k">.</span>NULL</span>)
    <span class="pl-k">int</span> <span class="pl-en">getSettingsOpenedCount</span>(); <span class="pl-c">// will return 0 as primitive types can't hold a reference</span>
}</pre></div>

<h3>
<a id="obtaining-a-more-customised-instance-at-run-time" class="anchor" href="#obtaining-a-more-customised-instance-at-run-time" aria-hidden="true"><span class="octicon octicon-link"></span></a>Obtaining a more customised instance at run-time</h3>

<p>As previously described you can build an instance of your interface using <code>StoreBox.build()</code>, however if you'd like to override at run-time any annotations you can use <code>StoreBox.Builder</code> and apply different options.</p>

<div class="highlight highlight-Java"><pre><span class="pl-smi">MyPreferences</span> preferences <span class="pl-k">=</span>
        <span class="pl-k">new</span> <span class="pl-smi">StoreBox</span>.<span class="pl-smi">Builder</span>(context, <span class="pl-smi">MyPreferences</span><span class="pl-k">.</span>class)
        .preferencesMode(<span class="pl-smi">PreferencesMode</span><span class="pl-c1"><span class="pl-k">.</span>MULTI_PROCESS</span>)
        .build()</pre></div>

<h3>
<a id="defaults" class="anchor" href="#defaults" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defaults</h3>

<p>Given the minimum amount of details provided to the interface and method definitions through the use of StoreBox's annotations, the following defaults will get used:</p>

<ul>
<li>Preferences type: Default shared preferences</li>
<li>Preferences mode: Private</li>
<li>Save mode: Apply</li>
<li>Default value mode: Empty</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<pre><code>Copyright 2015 Martin Bella

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/martino2k6/StoreBox">StoreBox</a> is maintained by <a href="https://github.com/martino2k6">martino2k6</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33402302-4");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>

